{% extends "base.html" %}
{% block title %}Academic Records{% endblock %}
{% block content %}

<h2 class="mb-3">Academic Records</h2>

<form method="get" class="mb-4 d-flex align-items-center">
    <label for="school-filter" class="form-label fw-bold me-2">Filter by School:</label>
    <select name="school" id="school-filter" class="form-select d-inline-block me-3" style="width:180px;">
        <option value="">All Schools</option>
        {% for val, label in schools %}
            <option value="{{ val }}" {% if request.GET.school == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>

    <label for="grade-filter" class="form-label fw-bold me-2">Filter by Grade:</label>
    <select name="grade" id="grade-filter" class="form-select d-inline-block me-3" style="width:140px;">
        <option value="">All Grades</option>
        {% for g in grade_levels %}
            <option value="{{ g }}" {% if request.GET.grade == g %}selected{% endif %}>{{ g }}</option>
        {% endfor %}
    </select>

    <button type="submit" class="btn btn-primary btn-sm">Apply</button>
    <a href="{% url 'academic_list' %}" class="btn btn-secondary btn-sm ms-2">Reset</a>
</form>

<table class="table table-hover align-middle">
    <thead class="table-dark">
        <tr>
            <th style="width: 20%;">Player</th>
            <th style="width: 20%;">School</th>
            <th style="width: 15%;">Grade Level</th>
            <th style="width: 15%;">Average Score</th>
            <th style="width: 10%;">Status</th>
            <th style="width: 15%;">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for record in records %}
            <tr>
                <td>{{ record.player.name }}</td>
                <td class="text-truncate" style="max-width: 200px;">{{ record.player.current_school }}</td>

                <td>
                    {% if record.grade_level %}
                        {{ record.grade_level }}
                    {% else %}
                        <strong>Needs input</strong>
                    {% endif %}
                </td>

                <td>
                    {% if record.average_score %}
                        {{ record.average_score|floatformat:"-1" }}%
                    {% else %}
                        <strong>Needs Score</strong>
                    {% endif %}
                </td>

                <td>
                    {% if record.average_score %}
                        {% if record.average_score >= 75 %}
                            <span class="badge bg-success">Passing</span>
                        {% else %}
                            <span class="badge bg-danger">Failing</span>
                        {% endif %}
                    {% else %}
                        {% if record.passing %}
                            <span class="badge bg-success">Passing</span>
                        {% else %}
                            <span class="badge bg-danger">Failing</span>
                        {% endif %}
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'edit_academic' record.id %}" class="btn btn-warning btn-sm">‚úèÔ∏è Edit</a>
                    <a href="{% url 'delete_academic' record.id %}" class="btn btn-danger btn-sm">üóë Delete</a>
                </td>
            </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center text-muted">No academic records available.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<p class="text-muted mb-4"><small>Students with scores above 75 are marked as passing, edit the scores and passing remarks here.</small></p>


{% endblock %}