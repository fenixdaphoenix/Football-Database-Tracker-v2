{% extends "base.html" %}
{% block title %}Academic Records{% endblock %}
{% block content %}

<h1 class="text-center mb-4">üìö Academic List</h1>

<div class="mb-4 text-center">
    <form method="get" class="d-inline-block">
        <select name="school" class="form-select d-inline-block w-auto me-2">
            <option value="">All Schools</option>
            {% for val, label in schools %}
                <option value="{{ val }}" {% if request.GET.school == val %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>

        <select name="grade" class="form-select d-inline-block w-auto me-2">
            <option value="">All Grades</option>
            {% for g in grade_levels %}
                <option value="{{ g }}" {% if request.GET.grade == g %}selected{% endif %}>{{ g }}</option>
            {% endfor %}
        </select>

        <button type="submit" class="btn btn-primary btn-sm">Filter</button>
        {% if request.GET.school or request.GET.grade %}
            <a href="{% url 'academic_list' %}" class="btn btn-secondary btn-sm">Reset</a>
        {% endif %}
    </form>
</div>

<table class="table table-bordered table-hover fs-4">
    <thead class="table-dark">
        <tr>
            <th class="px-4 py-3">Player</th>
            <th class="px-4 py-3">School</th>
            <th class="px-4 py-3">Grade Level</th>
            <th class="px-4 py-3">Average Score</th>
            <th class="px-4 py-3">Status</th>
            <th class="px-4 py-3 text-center">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for record in records %}
            <tr>
                <td class="px-4 py-3">{{ record.player.name }}</td>
                <td class="px-4 py-3">{{ record.player.current_school }}</td>

                <td class="px-4 py-3">
                    {% if record.grade_level %}
                        {{ record.grade_level }}
                    {% else %}
                        <strong>Needs input</strong>
                    {% endif %}
                </td>

                <td class="px-4 py-3">
                    {% if record.average_score %}
                        {{ record.average_score|floatformat:"-1" }}%
                    {% else %}
                        <strong>Needs Score</strong>
                    {% endif %}
                </td>

                <td class="px-4 py-3">
                    {% if record.average_score %}
                        {% if record.average_score >= 75 %}
                            <span class="badge bg-success">Passing</span>
                        {% else %}
                            <span class="badge bg-danger">Failing</span>
                        {% endif %}
                    {% else %}
                        {% if record.passing %}
                            <span class="badge bg-success">Passing</span>
                        {% else %}
                            <span class="badge bg-danger">Failing</span>
                        {% endif %}
                    {% endif %}
                </td>
                <td class="px-4 py-3 text-center">
                    <a href="{% url 'edit_academic' record.id %}" class="btn btn-warning btn-sm">‚úè Edit</a>
                    <a href="{% url 'delete_academic' record.id %}" class="btn btn-danger btn-sm">üóë Delete</a>
                </td>
            </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center text-muted px-4 py-3">No academic records available.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<a href="{% url 'add_academic' %}" 
    class="btn btn-success rounded-circle shadow-lg d-flex align-items-center justify-content-center"
    style="position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; font-size: 28px;">
    +
</a>

{% endblock %}